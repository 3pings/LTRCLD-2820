{% extends "base_cisco.html" %}
{% from "macros.html" import file, warn, info, cmd_blk_end, cmd_blk_start, term_end, topxterm, term_start, end_of_page,top_instance, copythis %}
{% block content %}
{% set step =  0 %}
{% set innerstep =  0 %}


<div class="section_header">
    <div class="title">Challenge</div>
    <div class="title_section">Lab 1</div>
</div>
{{ html_for_step_status|safe }}

<h3>You have been tasked to deploy a Wordpress application with persistent backend storage</h3>

<img src="/lab/imgman/pod/{{ data.pod_id }}/id/991" class="img-responsive">

<!--
##############################################################################################################################
Step {% set step = step +  1 %}
##############################################################################################################################
-->
<h3>Step {{ step }} - First, make your k8s access permanent from Jumphost</h3>
<p>Logout of your jumphost and then log back in; your jumphost is at {{data.pod_master_ip}}</p>
Run any "kubectl" command to see if you can access your cluster. You should not be able to access your cluster
because the "KUBECONFIG" enviroment variable only lasted the current session. Once you logged off, its gone.<br>
<b>Task 1: Setup the jumphost so that this won't happen the next time you login</b>

<p><code>Hint 1: You have already done something similar to this in the lab today!</code>
<br><code>Hint 2: See step 8 in the 'Installing Kubernetes' section under 'Baseline Topics'</code></p>

<!--
##############################################################################################################################
Step {% set step = step +  1 %}
##############################################################################################################################
-->
<h3>Step {{ step }} - Test kubernetes connection from Jumphost</h3>
<b>Logout and log back in after step 1 above, and test your connection again!</b>

<div class="fancy-terminal">
<pre class="command-line language-bash" data-prompt="{{ data.master_prompt}}">
<code class="language-bash">
kubectl get nodes -o wide
kubectl get namespace
kubectl get pods --all-namespaces
</code>
</pre>
</div>

<!--
##############################################################################################################################
Step {% set step = step +  1 %}
##############################################################################################################################
-->
<h3>Step {{ step }} - Create a MySQL password</h3>
<p>Since wordpress uses MySQL for backend database, let's setup a password for mysql to use.</p>
In kubernetes, there is this idea of a 'Secret'. A Secret is an object that stores a piece of sensitive data like a password or key.
Let's create a YAML file and deploy it.
<div class="fancy-terminal">
<pre class="command-line language-bash" data-prompt="{{ data.master_prompt}}">
<code class="language-bash">
  mkdir $HOME/clemea20/wp
  cd $HOME/clemea20/wp
cat &lt;&lt; EOF &gt; mysqlpass.yaml
secretGenerator:
- name: mysql-pass
literals:
- password=C1sco123
EOF
</code>
</pre>
</div>
<b>Task 2: Deploy this yaml file using kubectl command, check to see the results using <code>kubectl get secrets</code> command</b>
<pre>[ccpuser@{{data.apic_stdnt_uname}} wp]$ kubectl get secrets
NAME                    TYPE                                  DATA   AGE
default-token-sbpr5     kubernetes.io/service-account-token   3      8h
mysql-pass-ft899fkb85   Opaque                                1      54m
</pre>

<!--
##############################################################################################################################
Step {% set step = step +  1 %}
##############################################################################################################################
-->
<h3>Step {{ step }} - Install nano if you are not a 'Vi' editor fan!</h3>
<b>We'll be manipulating a few yaml manifests, let's make life easy by using nano. Hit 'y' when prompted, after entering the password.</b>

<div class="fancy-terminal">
<pre class="command-line language-bash" data-prompt="{{ data.master_prompt}}">
<code class="language-bash">
sudo yum install nano
</code>
</pre>
</div>


<!--
##############################################################################################################################
Step {% set step = step +  1 %}
##############################################################################################################################
-->
<h3>Step {{ step }} - Create two storage pvc mainfests</h3>
<p>Using nano, create two yaml files (use your imagination to name them) using the information below. These will create two PVCs. Using nano is easy, just type 'nano yourfilename.yaml'</p>
<p><b>Task 3: There is a key missing peice of information with regards to 'storage class' here. Add it to the bottom of both yaml files.</b></p>
<p><code>Hint 1. You have already deployed an application using persistent storage with HX! What you need is in there.</code></p>

<pre>
  apiVersion: v1
  kind: PersistentVolumeClaim
  metadata:
    name: mysql-pv-claim
    labels:
      app: wordpress
  spec:
    accessModes:
      - ReadWriteOnce
    resources:
      requests:
        storage: 20Gi
</pre>
<b>and another one</b> <pre>
  apiVersion: v1
  kind: PersistentVolumeClaim
  metadata:
    name: wp-pv-claim
    labels:
      app: wordpress
  spec:
    accessModes:
      - ReadWriteOnce
    resources:
      requests:
        storage: 20Gi
</pre>
<b>Once you have made the changes, go ahead and deploy the two yaml files using <code>kubectl</code></b>
To test, run '<code>kubectl get pvc</code>' and see if these are ready to be bound.
{{ end_of_page(page_position,data) }}
{% endblock %}
